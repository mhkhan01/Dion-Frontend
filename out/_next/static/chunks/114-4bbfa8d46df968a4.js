"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{4114:function(e,t,r){r.d(t,{Z:function(){return s}});var a=r(7437),n=r(7766),l=r(9376),i=r(7648);function s(){var e,t;let{user:r,signOut:s}=(0,n.a)(),c=(0,l.useRouter)(),o=null===(t=window.Capacitor)||void 0===t?void 0:null===(e=t.isNativePlatform)||void 0===e?void 0:e.call(t),d=async()=>{await s(),c.push("/")},u=()=>{if(!r)return"/";switch(r.role){case"contractor":return"/client";case"landlord":return"/partner";case"admin":return"/admin";default:return"/"}};return(0,a.jsx)("header",{className:"sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-gray-200 ".concat(o?"pt-safe":"pt-0"),children:(0,a.jsx)("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(i.default,{href:u(),className:"text-xl font-bold text-gray-900",children:"BookingHub"})}),r&&(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-8",children:[(0,a.jsx)(i.default,{href:u(),className:"nav-link",children:"Dashboard"}),"contractor"===r.role&&(0,a.jsx)(i.default,{href:"/client/properties",className:"nav-link",children:"Browse Properties"}),"landlord"===r.role&&(0,a.jsx)(i.default,{href:"/partner/properties",className:"nav-link",children:"My Properties"}),"admin"===r.role&&(0,a.jsx)(i.default,{href:"/admin/bookings",className:"nav-link",children:"All Bookings"})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"hidden sm:block text-sm text-gray-700",children:[(0,a.jsx)("div",{className:"font-medium",children:r.full_name}),(0,a.jsx)("div",{className:"text-gray-500 capitalize",children:r.role})]}),(0,a.jsx)("button",{onClick:d,className:"btn btn-ghost text-sm",children:"Sign Out"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.default,{href:"/auth/login",className:"btn btn-ghost",children:"Sign In"}),(0,a.jsx)(i.default,{href:"/auth/signup/client",className:"btn btn-primary",children:"Get Started"})]})})]})})})}},7766:function(e,t,r){r.d(t,{AuthProvider:function(){return c},a:function(){return s}});var a=r(7437),n=r(2265),l=r(5526);let i=(0,n.createContext)({user:null,loading:!0,signOut:async()=>{}}),s=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:t}=e,[r,s]=(0,n.useState)(null),[c,o]=(0,n.useState)(!0),[d,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(new Set);(0,n.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:t}}=await l.supabase.auth.getSession();e&&((null==t?void 0:t.user)?await f(t.user):s(null),o(!1))}catch(t){console.error("Error getting initial session:",t),e&&(s(null),o(!1))}})();let{data:{subscription:t}}=l.supabase.auth.onAuthStateChange(async(t,a)=>{if(e){if(null==a?void 0:a.user){if(h.has(a.user.id)||d||r&&r.id===a.user.id&&r.role&&("contractor"===r.role||"landlord"===r.role)){o(!1);return}r&&r.id===a.user.id&&r.role||await f(a.user)}else s(null),m(new Set);o(!1)}});return()=>{e=!1,t.unsubscribe()}},[]);let f=async e=>{var t,r,a;if(h.has(e.id)){u(!1),o(!1);return}if(!d){if(e&&e.id&&e.email&&e.role&&"authenticated"!==e.role&&"unauthenticated"!==e.role){s({...e,full_name:(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"User",role:e.role}),u(!1),o(!1);return}if(e&&e.id&&e.role&&("contractor"===e.role||"landlord"===e.role)){u(!1),o(!1);return}u(!0),m(t=>new Set(t).add(e.id));try{let t="contractor",a="https://jfgm6v6pkw.us-east-1.awsapprunner.com/api",[n,l]=await Promise.all([fetch("".concat(a,"/partner-login-check"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})}).then(e=>e.json()).catch(()=>({exists:!1})),fetch("".concat(a,"/client-login-check"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})}).then(e=>e.json()).catch(()=>({exists:!1}))]);n.exists?t="landlord":l.exists?t="contractor":e.email&&e.email.includes("landlord")&&(t="landlord");let i={...e,full_name:(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"User",role:t,is_active:!0,email_verified:!!e.email_confirmed_at};s(i),u(!1),o(!1);return}catch(r){console.error("Error fetching user profile:",r);let t=e.email&&e.email.includes("landlord")?"landlord":"contractor";s({...e,full_name:(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"User",role:t}),u(!1),o(!1)}finally{u(!1)}}},p=async()=>{await l.supabase.auth.signOut(),s(null),m(new Set)};return(0,a.jsx)(i.Provider,{value:{user:r,loading:c,signOut:p},children:t})}},5526:function(e,t,r){r.r(t),r.d(t,{supabase:function(){return a}});let a=(0,r(8439).eI)("https://gtdjjsxtlgzntmuimyai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0ZGpqc3h0bGd6bnRtdWlteWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzA3MjEsImV4cCI6MjA3MzU0NjcyMX0.OIU7JU8oxYb6LrRuTbRJGhWtcy6gH7_5JlML23D2sWE")}}]);