"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{4114:function(e,t,r){r.d(t,{Z:function(){return s}});var l=r(7437),a=r(7766),n=r(9376),i=r(7648);function s(){var e,t;let{user:r,signOut:s}=(0,a.a)(),o=(0,n.useRouter)(),c=null===(t=window.Capacitor)||void 0===t?void 0:null===(e=t.isNativePlatform)||void 0===e?void 0:e.call(t),d=async()=>{await s(),o.push("/")},u=()=>{if(!r)return"/";switch(r.role){case"contractor":return"/contractor";case"landlord":return"/landlord";case"admin":return"/admin";default:return"/"}};return(0,l.jsx)("header",{className:"sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-gray-200 ".concat(c?"pt-safe":"pt-0"),children:(0,l.jsx)("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)(i.default,{href:u(),className:"text-xl font-bold text-gray-900",children:"BookingHub"})}),r&&(0,l.jsxs)("div",{className:"hidden md:flex items-center space-x-8",children:[(0,l.jsx)(i.default,{href:u(),className:"nav-link",children:"Dashboard"}),"contractor"===r.role&&(0,l.jsx)(i.default,{href:"/contractor/properties",className:"nav-link",children:"Browse Properties"}),"landlord"===r.role&&(0,l.jsx)(i.default,{href:"/landlord/properties",className:"nav-link",children:"My Properties"}),"admin"===r.role&&(0,l.jsx)(i.default,{href:"/admin/bookings",className:"nav-link",children:"All Bookings"})]}),(0,l.jsx)("div",{className:"flex items-center space-x-4",children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"hidden sm:block text-sm text-gray-700",children:[(0,l.jsx)("div",{className:"font-medium",children:r.full_name}),(0,l.jsx)("div",{className:"text-gray-500 capitalize",children:r.role})]}),(0,l.jsx)("button",{onClick:d,className:"btn btn-ghost text-sm",children:"Sign Out"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.default,{href:"/auth/login",className:"btn btn-ghost",children:"Sign In"}),(0,l.jsx)(i.default,{href:"/auth/signup/client",className:"btn btn-primary",children:"Get Started"})]})})]})})})}},7766:function(e,t,r){r.d(t,{AuthProvider:function(){return o},a:function(){return s}});var l=r(7437),a=r(2265),n=r(5526);let i=(0,a.createContext)({user:null,loading:!0,signOut:async()=>{}}),s=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},o=e=>{let{children:t}=e,[r,s]=(0,a.useState)(null),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:t}}=await n.supabase.auth.getSession();e&&((null==t?void 0:t.user)?await f(t.user):s(null),c(!1))}catch(t){console.error("Error getting initial session:",t),e&&(s(null),c(!1))}})();let{data:{subscription:t}}=n.supabase.auth.onAuthStateChange(async(t,l)=>{if(e){if(null==l?void 0:l.user){if(h.has(l.user.id)||d||r&&r.id===l.user.id&&r.role&&("contractor"===r.role||"landlord"===r.role)){c(!1);return}r&&r.id===l.user.id&&r.role||await f(l.user)}else s(null),m(new Set);c(!1)}});return()=>{e=!1,t.unsubscribe()}},[]);let f=async e=>{var t,r,l;if(h.has(e.id)){u(!1),c(!1);return}if(!d){if(e&&e.id&&e.email&&e.role&&"authenticated"!==e.role&&"unauthenticated"!==e.role){s({...e,full_name:(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"User",role:e.role}),u(!1),c(!1);return}if(e&&e.id&&e.role&&("contractor"===e.role||"landlord"===e.role)){u(!1),c(!1);return}u(!0),m(t=>new Set(t).add(e.id));try{let t="contractor";e.email&&e.email.includes("landlord")&&(t="landlord");let l={...e,full_name:(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"User",role:t,is_active:!0,email_verified:!!e.email_confirmed_at};s(l),u(!1),c(!1);return}catch(t){console.error("Error fetching user profile:",t),s({...e,full_name:(null===(l=e.email)||void 0===l?void 0:l.split("@")[0])||"User",role:"contractor"}),u(!1),c(!1)}finally{u(!1)}}},x=async()=>{await n.supabase.auth.signOut(),s(null),m(new Set)};return(0,l.jsx)(i.Provider,{value:{user:r,loading:o,signOut:x},children:t})}},5526:function(e,t,r){r.r(t),r.d(t,{supabase:function(){return l}});let l=(0,r(8439).eI)("https://gtdjjsxtlgzntmuimyai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0ZGpqc3h0bGd6bnRtdWlteWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzA3MjEsImV4cCI6MjA3MzU0NjcyMX0.OIU7JU8oxYb6LrRuTbRJGhWtcy6gH7_5JlML23D2sWE")}}]);