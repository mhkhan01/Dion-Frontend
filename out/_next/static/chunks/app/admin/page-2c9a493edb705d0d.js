(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{627:function(e,s,a){Promise.resolve().then(a.bind(a,6683))},6683:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var t=a(7437),l=a(2265),r=a(7766),n=a(9376),i=a(3281),d=a(4114);function c(){let{user:e,loading:s}=(0,r.a)(),i=(0,n.useRouter)(),[c,h]=(0,l.useState)(null),[x,m]=(0,l.useState)([]),[j,p]=(0,l.useState)(!0);(0,l.useEffect)(()=>{if(!s&&!e){i.push("/auth/login");return}if(e&&"admin"!==e.role){i.push("/");return}},[e,s,i]),(0,l.useEffect)(()=>{e&&g()},[e]);let g=async()=>{try{let e=(await Promise.resolve().then(a.bind(a,5526))).supabase.auth.getSession(),s=await e;if(!s.data.session)throw Error("No session found");let t=await fetch("https://jfgm6v6pkw.us-east-1.awsapprunner.com/api/admin/dashboard",{headers:{Authorization:"Bearer ".concat(s.data.session.access_token)}});if(t.ok){let e=await t.json();h(e.stats)}let l=await fetch("https://jfgm6v6pkw.us-east-1.awsapprunner.com/api/admin/bookings?limit=20",{headers:{Authorization:"Bearer ".concat(s.data.session.access_token)}});if(l.ok){let e=await l.json();m(e.bookings)}}catch(e){console.error("Error fetching admin data:",e)}finally{p(!1)}},u=async(e,s)=>{try{let t=(await Promise.resolve().then(a.bind(a,5526))).supabase.auth.getSession(),l=await t;if(!l.data.session)throw Error("No session found");(await fetch("https://jfgm6v6pkw.us-east-1.awsapprunner.com/api/admin/bookings/".concat(e,"/confirm"),{method:"PUT",headers:{Authorization:"Bearer ".concat(l.data.session.access_token),"Content-Type":"application/json"},body:JSON.stringify({status:s})})).ok?g():alert("Failed to update booking status")}catch(e){console.error("Error confirming booking:",e),alert("Failed to update booking status")}};return s||j?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(d.Z,{}),(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})]}):e?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(d.Z,{}),(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Manage all bookings, properties, and users across the platform"})]}),c&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[(0,t.jsx)("div",{className:"card p-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Bookings"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:c.totalBookings})]})]})}),(0,t.jsx)("div",{className:"card p-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Properties"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-green-600",children:c.totalProperties})]})]})}),(0,t.jsx)("div",{className:"card p-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Users"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:c.totalUsers})]})]})}),(0,t.jsx)("div",{className:"card p-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:c.pendingBookings})]})]})}),(0,t.jsx)("div",{className:"card p-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-2 bg-indigo-100 rounded-lg",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Paid"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-indigo-600",children:c.paidBookings})]})]})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"All Bookings"})}),(0,t.jsx)(o,{bookings:x,onConfirmBooking:u})]})]})]}):null}function o(e){let{bookings:s,onConfirmBooking:a}=e,l=e=>{switch(e){case"pending":return(0,t.jsx)("span",{className:"badge badge-warning",children:"Pending"});case"confirmed":return(0,t.jsx)("span",{className:"badge badge-info",children:"Confirmed"});case"cancelled":return(0,t.jsx)("span",{className:"badge badge-danger",children:"Cancelled"});case"paid":return(0,t.jsx)("span",{className:"badge badge-success",children:"Paid"});default:return(0,t.jsx)("span",{className:"badge",children:e})}};return 0===s.length?(0,t.jsxs)("div",{className:"px-6 py-12 text-center",children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No bookings"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"No bookings have been created yet."})]}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{className:"table-header",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"table-header-cell",children:"Property"}),(0,t.jsx)("th",{className:"table-header-cell",children:"Contractor"}),(0,t.jsx)("th",{className:"table-header-cell",children:"Dates"}),(0,t.jsx)("th",{className:"table-header-cell",children:"Amount"}),(0,t.jsx)("th",{className:"table-header-cell",children:"Status"}),(0,t.jsx)("th",{className:"table-header-cell",children:"Actions"}),(0,t.jsx)("th",{className:"table-header-cell",children:"Created"})]})}),(0,t.jsx)("tbody",{className:"table-body",children:s.map(e=>{let s=new Date(e.start_date),r=new Date(e.end_date),n=Math.ceil((r.getTime()-s.getTime())/864e5),d=e.property.price*n;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.property.title}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.property.address})]})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.contractor.full_name})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{children:(0,i.Z)(s,"MMM dd, yyyy")}),(0,t.jsxs)("div",{className:"text-gray-500",children:["to ",(0,i.Z)(r,"MMM dd, yyyy")]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400",children:[n," days"]})]})}),(0,t.jsxs)("td",{className:"table-cell",children:[(0,t.jsxs)("div",{className:"font-medium",children:["$",d.toFixed(2)]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["$",e.property.price,"/day"]})]}),(0,t.jsx)("td",{className:"table-cell",children:l(e.status)}),(0,t.jsx)("td",{className:"table-cell",children:"pending"===e.status&&(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>a(e.id,"confirmed"),className:"btn btn-primary text-xs px-3 py-1",children:"Confirm"}),(0,t.jsx)("button",{onClick:()=>a(e.id,"cancelled"),className:"btn btn-danger text-xs px-3 py-1",children:"Cancel"})]})}),(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsx)("div",{className:"text-sm text-gray-500",children:(0,i.Z)(new Date(e.created_at),"MMM dd, yyyy")})})]},e.id)})})]})})}}},function(e){e.O(0,[439,648,53,114,971,117,744],function(){return e(e.s=627)}),_N_E=e.O()}]);