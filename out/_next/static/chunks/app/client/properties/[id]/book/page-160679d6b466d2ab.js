(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{1638:function(e,t,s){Promise.resolve().then(s.bind(s,3462))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},3462:function(e,t,s){"use strict";s.d(t,{default:function(){return u}});var a=s(7437),r=s(2265),n=s(9376),i=s(7766),l=s(9501),c=s(3590),d=s(7119),m=s(5526),o=s(4114),x=s(257);let h=d.Ry({start_date:d.Z_().min(1,"Start date is required"),end_date:d.Z_().min(1,"End date is required")}).refine(e=>new Date(e.end_date)>new Date(e.start_date),{message:"End date must be after start date",path:["end_date"]});function u(){let{user:e,loading:t}=(0,i.a)(),s=(0,n.useParams)(),d=(0,n.useRouter)(),[u,p]=(0,r.useState)(null),[b,f]=(0,r.useState)(!0),[g,j]=(0,r.useState)(!1),{register:y,handleSubmit:N,formState:{errors:_},watch:w}=(0,l.cI)({resolver:(0,c.F)(h)}),v=w("start_date"),k=w("end_date");(0,r.useEffect)(()=>{if(!t&&!e){d.push("/auth/login");return}if(e&&"contractor"!==e.role){d.push("/");return}},[e,t,d]),(0,r.useEffect)(()=>{s.id&&S()},[s.id]);let S=async()=>{try{let{data:e,error:t}=await m.supabase.from("properties").select("*").eq("id",s.id).single();if(t){console.error("Error fetching property:",t),d.push("/client/properties");return}p(e)}catch(e){console.error("Error fetching property:",e),d.push("/client/properties")}finally{f(!1)}},P=async t=>{if(u&&e){j(!0);try{let e=await m.supabase.auth.getSession();if(!e.data.session)throw Error("No session found");let s=await fetch("https://jfgm6v6pkw.us-east-1.awsapprunner.com/api/bookings/create",{method:"POST",headers:{Authorization:"Bearer ".concat(e.data.session.access_token),"Content-Type":"application/json"},body:JSON.stringify({property_id:u.id,start_date:t.start_date,end_date:t.end_date})});if(s.ok){let e=await s.json();d.push("/client?booking=".concat(e.booking.id))}else{let e=await s.json();alert(e.error||"Failed to create booking")}}catch(e){console.error("Error creating booking:",e),alert("Failed to create booking")}finally{j(!1)}}};return t||b?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(o.Z,{}),(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})]}):e&&u?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(o.Z,{}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-8",children:[(0,a.jsxs)("div",{className:"mb-4 sm:mb-8",children:[(0,a.jsx)("button",{onClick:()=>d.back(),className:"btn btn-ghost mb-2 sm:mb-4 text-sm sm:text-base",children:"â† Back to Properties"}),(0,a.jsx)("h1",{className:"text-xl sm:text-3xl font-bold text-gray-900",children:"Book Property"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8",children:[(0,a.jsxs)("div",{className:"card p-4 sm:p-6",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-3 sm:mb-4",children:u.title}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Address"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm sm:text-base",children:u.address})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Price"}),(0,a.jsxs)("p",{className:"text-xl sm:text-2xl font-bold text-primary-600",children:["$",u.price," per day"]})]}),u.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Description"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm sm:text-base",children:u.description})]}),u.lat&&u.lng&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2 text-sm sm:text-base",children:"Location"}),(0,a.jsx)("div",{className:"w-full h-32 sm:h-48 bg-gray-200 rounded-lg flex items-center justify-center",children:(0,a.jsx)("iframe",{src:"https://www.google.com/maps/embed/v1/place?key=".concat(x.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,"&q=").concat(u.lat,",").concat(u.lng),width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"})})]})]})]}),(0,a.jsxs)("div",{className:"card p-4 sm:p-6",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-4 sm:mb-6",children:"Booking Details"}),(0,a.jsxs)("form",{onSubmit:N(P),className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"start_date",className:"label text-sm sm:text-base",children:"Start Date"}),(0,a.jsx)("input",{...y("start_date"),type:"date",min:new Date().toISOString().split("T")[0],className:"input text-sm sm:text-base ".concat(_.start_date?"input-error":"")}),_.start_date&&(0,a.jsx)("p",{className:"error-text text-xs sm:text-sm",children:_.start_date.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"end_date",className:"label text-sm sm:text-base",children:"End Date"}),(0,a.jsx)("input",{...y("end_date"),type:"date",min:v||new Date().toISOString().split("T")[0],className:"input text-sm sm:text-base ".concat(_.end_date?"input-error":"")}),_.end_date&&(0,a.jsx)("p",{className:"error-text text-xs sm:text-sm",children:_.end_date.message})]}),v&&k&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3 sm:p-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 text-sm sm:text-base",children:"Booking Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Daily Rate:"}),(0,a.jsxs)("span",{children:["$",u.price]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Number of Days:"}),(0,a.jsx)("span",{children:Math.ceil((new Date(k).getTime()-new Date(v).getTime())/864e5)})]}),(0,a.jsxs)("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{className:"text-primary-600",children:["$",(()=>{if(!u||!v||!k)return 0;let e=new Date(v);return Math.ceil((new Date(k).getTime()-e.getTime())/864e5)*u.price})().toFixed(2)]})]})]})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600 text-center",children:["By submitting, you agree to our"," ",(0,a.jsx)("a",{href:"/terms",className:"text-primary-600 hover:text-primary-700 underline font-medium",children:"Client Terms & Conditions"}),"."]})}),(0,a.jsx)("button",{type:"submit",disabled:g||!v||!k,className:"btn btn-primary w-full text-sm sm:text-base py-2 sm:py-3",children:g?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b-2 border-white mr-2"}),"Creating Booking..."]}):"Create Booking Request"})]})]})]})]})]}):null}}},function(e){e.O(0,[439,648,626,114,971,117,744],function(){return e(e.s=1638)}),_N_E=e.O()}]);