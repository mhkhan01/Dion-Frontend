(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[89],{9509:function(e,t,o){Promise.resolve().then(o.bind(o,3824))},9376:function(e,t,o){"use strict";var a=o(5475);o.o(a,"useParams")&&o.d(t,{useParams:function(){return a.useParams}}),o.o(a,"useRouter")&&o.d(t,{useRouter:function(){return a.useRouter}}),o.o(a,"useSearchParams")&&o.d(t,{useSearchParams:function(){return a.useSearchParams}})},3824:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return m}});var a=o(7437),s=o(2265),n=o(3145),r=o(7648),i=o(9376),l=o(7766),d=o(5526);function c(){let e=(0,i.useSearchParams)(),{user:t}=(0,l.a)(),[o,c]=(0,s.useState)({fullName:"",companyName:"",email:"",phone:"",projectPostcode:"",teamSize:"",city:""}),[m,u]=(0,s.useState)({full_name:"",company_name:"",company_email:"",company_phone:"",company_address:"",project_postcode:"",city:"",team_size:""}),[g,p]=(0,s.useState)([{id:"1",startDate:"",endDate:""}]),[b,f]=(0,s.useState)([{id:"1",label:"< \xa3200"},{id:"2",label:"\xa3200-\xa3300"},{id:"3",label:"\xa3300-\xa3400"},{id:"4",label:"\xa3400+"}]),[x,h]=(0,s.useState)(""),[_,y]=(0,s.useState)(!1),[k,v]=(0,s.useState)(null),[j,N]=(0,s.useState)([]),[w,S]=(0,s.useState)(!1),[D,q]=(0,s.useState)(!1),[E,P]=(0,s.useState)(null),[C,I]=(0,s.useState)(!1),[z,B]=(0,s.useState)(!1),F=(0,s.useRef)(null),O=e=>{let{name:t,value:o}=e.target;c(e=>({...e,[t]:o}))},A=e=>{g.length>1&&p(t=>t.filter(t=>t.id!==e))},G=(e,t,o)=>{p(a=>a.map(a=>a.id===e?{...a,[t]:o}:a))},L=async e=>{e.preventDefault(),B(!0);try{let e;if(D&&E){console.log("Updating existing booking request:",E);let{error:a}=await d.supabase.from("booking_requests").update({full_name:o.fullName||m.full_name,company_name:o.companyName||m.company_name,email:o.email||m.company_email||(null==t?void 0:t.email),phone:o.phone||m.company_phone,project_postcode:o.projectPostcode||m.project_postcode,team_size:o.teamSize?parseInt(o.teamSize):null,budget_per_person_week:x,user_id:(null==t?void 0:t.id)||(null==k?void 0:k.user_id),city:o.city||m.city}).eq("id",E);if(a){console.error("Error updating booking request:",a),alert("Failed to update booking request. Please try again."),B(!1);return}e={...k,id:E},console.log("Successfully updated booking request")}else if(k){if(e=k,console.log("Using existing booking request:",e.id),console.log("Existing booking request data:",k),(null==t?void 0:t.id)&&!e.user_id){console.log("Updating booking request with user_id:",t.id);let{error:o}=await d.supabase.from("booking_requests").update({user_id:t.id}).eq("id",e.id);o?console.error("Error updating booking request with user_id:",o):(console.log("Successfully updated booking request with user_id"),e.user_id=t.id)}}else{let{data:a,error:s}=await d.supabase.from("booking_requests").insert({full_name:o.fullName||m.full_name,company_name:o.companyName||m.company_name,email:o.email||m.company_email||(null==t?void 0:t.email),phone:o.phone||m.company_phone,project_postcode:o.projectPostcode||m.project_postcode,team_size:o.teamSize?parseInt(o.teamSize):null,budget_per_person_week:x,status:"pending",user_id:(null==t?void 0:t.id)||null,city:o.city||m.city}).select().single();if(s){console.error("Error saving to Supabase:",s),alert("Failed to save booking request. Please try again."),B(!1);return}e=a}let a=[];if(console.log("Booking request for saving dates:",e),console.log("Bookings array length:",g.length),e&&g.length>0){if(D){console.log("Edit mode: Processing booking dates");let{error:e}=await d.supabase.from("booking_dates").delete().eq("booking_request_id",E);if(e){console.error("Error deleting existing booking dates:",e),alert("Failed to update booking dates. Please try again."),B(!1);return}let t=g.filter(e=>{let t=e.startDate&&e.endDate&&""!==e.startDate.trim()&&""!==e.endDate.trim();return console.log("Edit mode - Booking ".concat(e.id,": hasValidDates=").concat(t,', startDate="').concat(e.startDate,'", endDate="').concat(e.endDate,'"')),t});if(console.log("Edit mode - Bookings to save:",t),t.length>0){let e=t.map(e=>({booking_request_id:E,start_date:e.startDate.trim(),end_date:e.endDate.trim()}));for(let t of e)if(new Date(t.start_date)>=new Date(t.end_date)){console.error("Invalid date range: start_date must be before end_date"),alert("Invalid date range: Start date must be before end date."),B(!1);return}console.log("Saving updated booking dates to database:",e);try{let{data:t,error:o}=await d.supabase.from("booking_dates").insert(e).select("id, start_date, end_date");if(o){console.error("Error saving updated booking dates:",o),alert("Booking request updated but dates failed. Please contact support."),B(!1);return}console.log("Successfully saved updated booking dates:",t),a=t||[]}catch(e){console.error("Exception during booking dates insert:",e),alert("An error occurred while saving booking dates. Please try again."),B(!1);return}}}else{let t=k?g.filter(e=>{let t=e.startDate&&e.endDate&&""!==e.startDate.trim()&&""!==e.endDate.trim(),o=e.id.startsWith("new-");return console.log("Existing request - Booking ".concat(e.id,": hasValidDates=").concat(t,", isNewBooking=").concat(o,', startDate="').concat(e.startDate,'", endDate="').concat(e.endDate,'"')),t&&o}):g.filter(e=>{let t=e.startDate&&e.endDate&&""!==e.startDate.trim()&&""!==e.endDate.trim();return console.log("New request - Booking ".concat(e.id,": hasValidDates=").concat(t,', startDate="').concat(e.startDate,'", endDate="').concat(e.endDate,'"')),t});console.log("All bookings:",g),console.log("Bookings to save:",t),console.log("Is existing request:",!!k),console.log("Booking details:",g.map(e=>({id:e.id,startDate:e.startDate,endDate:e.endDate,startsWithNew:e.id.startsWith("new-"),hasDates:e.startDate&&e.endDate&&""!==e.startDate.trim()&&""!==e.endDate.trim()})));let o=t.map(t=>({booking_request_id:e.id,start_date:t.startDate.trim(),end_date:t.endDate.trim()}));for(let e of o)if(new Date(e.start_date)>=new Date(e.end_date)){console.error("Invalid date range: start_date must be before end date."),alert("Invalid date range: Start date must be before end date."),B(!1);return}if(o.length>0){console.log("Saving booking dates to database:",o),console.log("Booking dates data details:",o.map(e=>({booking_request_id:e.booking_request_id,start_date:e.start_date,end_date:e.end_date,start_date_type:typeof e.start_date,end_date_type:typeof e.end_date})));try{let{data:e,error:t}=await d.supabase.from("booking_dates").insert(o).select("id, start_date, end_date");if(t){console.error("Error saving booking dates:",t),console.error("Error details:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),alert("Booking request saved but dates failed. Please contact support."),B(!1);return}if(console.log("Successfully saved booking dates:",e),console.log("Saved booking dates structure:",null==e?void 0:e.map(e=>({id:e.id,start_date:e.start_date,end_date:e.end_date,id_type:typeof e.id,id_string:String(e.id),id_json:JSON.stringify(e.id),full_object:e}))),null==e||e.forEach((e,t)=>{console.log("Verifying booking date ".concat(t+1," ID:"),{id:e.id,id_type:typeof e.id,is_uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.id),id_length:e.id?e.id.length:0})}),e&&e.length>0)a=e;else{console.error("No saved dates returned from Supabase"),alert("Booking dates were not saved properly. Please try again."),B(!1);return}}catch(e){console.error("Exception during booking dates insert:",e),alert("An error occurred while saving booking dates. Please try again."),B(!1);return}}else console.log("No new booking dates to save")}}else console.log("Cannot save booking dates - bookingRequest:",e,"bookings.length:",g.length);let s=0,n=0;for(let e=0;e<a.length;e++){let r=a[e];if(console.log("Processing saved booking ".concat(e+1,":"),{id:r.id,start_date:r.start_date,end_date:r.end_date,id_type:typeof r.id,id_undefined:void 0===r.id,id_null:null===r.id,id_string:String(r.id),id_length:r.id?r.id.length:"N/A",raw_object:r}),!r.id){console.error("Booking date ".concat(e+1," has no valid ID:"),r),n++;continue}let i=r.id;console.log("Using exact booking date ID for GHL:",{original_id:i,id_type:typeof i,id_value:i,id_stringified:JSON.stringify(i)});let l={full_name:o.fullName||m.full_name,company_name:o.companyName||m.company_name,email:o.email||m.company_email||(null==t?void 0:t.email),phone:o.phone||m.company_phone,project_postcode:o.projectPostcode||m.project_postcode,team_size:o.teamSize,budget_per_person_week:x,city:o.city||m.city,booking_start_date:r.start_date,booking_end_date:r.end_date,booking_date_id:i};try{console.log("Sending GHL data for booking ".concat(e+1,":"),l),console.log("GHL booking_date_id verification:",{id_in_object:l.booking_date_id,id_from_supabase:i,ids_match:l.booking_date_id===i,id_type_in_object:typeof l.booking_date_id,id_type_from_supabase:typeof i});let t=await fetch("https://services.leadconnectorhq.com/hooks/JxGt5Zz3odpUbS4vgmeC/webhook-trigger/40188edf-a93f-44aa-a6bf-9b564ef16dd4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});t.ok?(console.log("GHL data sent successfully for booking ".concat(e+1)),s++):(console.error("Failed to send GHL data for booking ".concat(e+1,":"),t.status,t.statusText),n++)}catch(t){console.error("Error sending GHL data for booking ".concat(e+1,":"),t),n++}}s>0&&0===n?(console.log("All GHL requests sent successfully"),console.log("Booking request saved to Supabase successfully")):s>0&&n>0?console.log("GHL: ".concat(s," successful, ").concat(n," failed")):console.error("All GHL requests failed"),I(!0),B(!1)}catch(e){console.error("Error submitting form:",e),alert("An error occurred. Please try again."),B(!1)}};return((0,s.useEffect)(()=>{(async()=>{if(null==t?void 0:t.id)try{let{data:o,error:a}=await d.supabase.from("contractor").select("full_name, company_name, company_email, company_address, phone, email").eq("id",t.id).single(),{data:s,error:n}=await d.supabase.from("booking_requests").select("project_postcode, city, team_size").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1).single();a&&"PGRST116"!==a.code&&console.error("Error fetching contractor data:",a),n&&"PGRST116"!==n.code&&console.error("Error fetching booking request data:",n);let r={full_name:(null==o?void 0:o.full_name)||"",company_name:(null==o?void 0:o.company_name)||"",company_email:(null==o?void 0:o.company_email)||(null==o?void 0:o.email)||"",company_phone:(null==o?void 0:o.phone)||"",company_address:(null==o?void 0:o.company_address)||"",project_postcode:(null==s?void 0:s.project_postcode)||"",city:(null==s?void 0:s.city)||"",team_size:(null==s?void 0:s.team_size)||""};u({full_name:r.full_name,company_name:r.company_name,company_email:r.company_email,company_phone:r.company_phone,company_address:r.company_address,project_postcode:r.project_postcode,city:r.city,team_size:r.team_size});let i=e.get("edit"),l="true"===e.get("prefill");i||l||c(e=>({...e,fullName:r.full_name||e.fullName,companyName:r.company_name||e.companyName,email:r.company_email||t.email||e.email,phone:r.company_phone||e.phone}))}catch(e){console.error("Error fetching contractor data:",e)}})()},[t,e]),(0,s.useEffect)(()=>{(async()=>{let o=e.get("edit"),a="true"===e.get("prefill");if(o||a){S(!0);try{let e;if(o){q(!0),P(o);let{data:t,error:a}=await d.supabase.from("booking_requests").select("*").eq("id",o).single();if(a){console.error("Error fetching booking request for edit:",a),alert("Error loading booking request for editing. Please try again."),S(!1);return}e=t}else if(a&&(null==t?void 0:t.email)){let{data:o,error:a}=await d.supabase.from("booking_requests").select("*").eq("email",t.email).single();if(a){console.log("No existing booking request found for prefill"),S(!1);return}e=o}else{console.log("No user email found, showing empty form"),S(!1);return}if(e){console.log("Found existing booking request:",e),v(e);let t="";if(e.user_id){let{data:o,error:a}=await d.supabase.from("contractor").select("phone").eq("id",e.user_id).single();!a&&o&&(t=o.phone||"")}let{data:a,error:s}=await d.supabase.from("booking_dates").select("*").eq("booking_request_id",e.id);if(a&&!s){N(a),c({fullName:e.full_name||"",companyName:e.company_name||"",email:e.email||"",phone:t,projectPostcode:e.project_postcode||"",teamSize:e.team_size||"",city:e.city||""}),e.budget_per_person_week&&(h(e.budget_per_person_week),console.log("Prefilled budget option:",e.budget_per_person_week));let s=a.map((e,t)=>({id:"existing-".concat(t+1),startDate:e.start_date,endDate:e.end_date}));o?p(s):p([...s,{id:"new-1",startDate:"",endDate:""}])}}}catch(e){console.error("Error fetching existing booking data:",e)}finally{S(!1)}}})()},[e,null==t?void 0:t.email]),(0,s.useEffect)(()=>{let e=e=>{F.current&&!F.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),w)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-booking-bg via-booking-bg to-booking-teal/5 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-booking-teal mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-booking-gray",children:"Loading your existing booking data..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen relative overflow-hidden",style:{backgroundImage:"url(/Swansea%20-%201.webp)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-[rgba(11,29,52,0.88)] pointer-events-none"}),(0,a.jsxs)(r.default,{href:"/client",className:"absolute top-4 left-4 z-20 flex items-center gap-3 text-[#F6F6F4] transition-colors duration-200 group hover:text-[#00BAB5]","aria-label":"Back to dashboard",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,a.jsx)("span",{className:"text-xl sm:text-2xl font-bold text-[#F6F6F4]",children:"Back"})]}),(0,a.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center min-h-screen py-4 px-2 sm:py-8 sm:px-4 pb-12 sm:pb-16",children:[(0,a.jsx)("div",{className:"mb-4 sm:mb-8 w-full max-w-xs sm:max-w-2xl py-2",children:(0,a.jsx)(n.default,{src:"/blue-teal.webp",alt:"Booking Hub Logo",width:800,height:200,className:"w-full h-auto object-contain",style:{maxWidth:"100%"},priority:!0})}),(0,a.jsxs)("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl sm:rounded shadow-xl sm:shadow-lg p-6 sm:p-6 lg:p-8 w-full max-w-xs sm:max-w-lg lg:max-w-2xl border border-gray-200/50 sm:border-gray-200",children:[(0,a.jsx)("h1",{className:"text-base sm:text-2xl lg:text-3xl font-bold text-booking-dark mb-1 sm:mb-2 text-center leading-tight",children:"Request Accommodation"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-booking-gray mb-4 sm:mb-6 text-center",children:"Submit your requirements and we'll handle the rest"}),(0,a.jsxs)("form",{onSubmit:L,className:"space-y-3 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"city",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Where do you need accommodation?"}),(0,a.jsx)("input",{type:"text",id:"city",name:"city",value:o.city,onChange:O,placeholder:"e.g. London",className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"projectPostcode",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Accommodation Postcode"}),(0,a.jsx)("input",{type:"text",id:"projectPostcode",name:"projectPostcode",value:o.projectPostcode,onChange:O,className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"Enter postcode"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Booking Dates"}),g.map((e,t)=>(0,a.jsxs)("div",{className:"mb-3",children:[g.length>1&&(0,a.jsx)("div",{className:"flex justify-end items-center mb-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>A(e.id),className:"text-red-500 hover:text-red-700 text-xs sm:text-sm",children:"Remove"})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Start Date"}),(0,a.jsx)("input",{type:"date",value:e.startDate,onChange:t=>G(e.id,"startDate",t.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"End Date"}),(0,a.jsx)("input",{type:"date",value:e.endDate,onChange:t=>G(e.id,"endDate",t.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",required:!0})]})]})]},e.id)),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("button",{type:"button",onClick:()=>{let e={id:"new-".concat(Date.now()),startDate:"",endDate:""};p(t=>[...t,e])},className:"w-full sm:w-auto bg-booking-teal text-white px-4 py-2 rounded-md hover:bg-booking-dark transition-colors duration-200 text-xs sm:text-sm font-medium",children:"+ Add Booking"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"teamSize",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"How many people?"}),(0,a.jsx)("input",{type:"number",id:"teamSize",name:"teamSize",value:o.teamSize,onChange:O,min:"1",className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"Number of people",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"budgetPerPerson",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Nightly budget"}),(0,a.jsx)("input",{type:"number",id:"budgetPerPerson",name:"budgetPerPerson",value:x,onChange:e=>h(e.target.value),min:"0",className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"Enter budget amount"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fullName",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Name *"}),(0,a.jsx)("input",{type:"text",id:"fullName",name:"fullName",value:o.fullName,onChange:O,className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"Your full name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"companyName",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Company Name *"}),(0,a.jsx)("input",{type:"text",id:"companyName",name:"companyName",value:o.companyName,onChange:O,className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"Your company name",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Company Email *"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:o.email,onChange:O,className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"your.email@company.com",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phone",className:"block text-xs sm:text-sm font-medium text-booking-dark mb-1 sm:mb-2",children:"Phone *"}),(0,a.jsx)("input",{type:"tel",id:"phone",name:"phone",value:o.phone,onChange:O,className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-booking-teal rounded focus:outline-none focus:ring-2 focus:ring-booking-teal focus:border-transparent",placeholder:"Your phone number",required:!0})]})]}),C&&(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:(0,a.jsx)("p",{className:"text-green-800 text-sm sm:text-base font-medium",children:D?"Thanks — your amendments request has been received.":"Thanks — your request has been received."})})}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-booking-gray text-center",children:["By submitting, you agree to our"," ",(0,a.jsx)("a",{href:"/terms",className:"text-booking-teal hover:text-booking-dark underline font-medium",children:"Client Terms & Conditions"}),"."]})}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)("button",{type:"submit",disabled:z,className:"w-full bg-booking-teal text-white py-3 sm:py-4 px-6 rounded-lg font-semibold text-sm sm:text-base hover:bg-booking-dark transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-booking-teal focus:ring-offset-2 flex items-center justify-center disabled:opacity-70 disabled:cursor-not-allowed",children:z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):D?"UPDATE BOOKING REQUEST":k?"ADD NEW BOOKING DATES":"SUBMIT BOOKING REQUEST"})})]})]})]})]})}function m(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-booking-teal"})}),children:(0,a.jsx)(c,{})})}},7766:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return l},a:function(){return i}});var a=o(7437),s=o(2265),n=o(5526);let r=(0,s.createContext)({user:null,loading:!0,signOut:async()=>{}}),i=()=>{let e=(0,s.useContext)(r);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[o,i]=(0,s.useState)(null),[l,d]=(0,s.useState)(!0),[c,m]=(0,s.useState)(!1),[u,g]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:t}}=await n.supabase.auth.getSession();e&&((null==t?void 0:t.user)?await p(t.user):i(null),d(!1))}catch(t){console.error("Error getting initial session:",t),e&&(i(null),d(!1))}})();let{data:{subscription:t}}=n.supabase.auth.onAuthStateChange(async(t,a)=>{if(e){if(null==a?void 0:a.user){if(u.has(a.user.id)||c||o&&o.id===a.user.id&&o.role&&("contractor"===o.role||"landlord"===o.role)){d(!1);return}o&&o.id===a.user.id&&o.role||await p(a.user)}else i(null),g(new Set);d(!1)}});return()=>{e=!1,t.unsubscribe()}},[]);let p=async e=>{var t,o,a;if(u.has(e.id)){m(!1),d(!1);return}if(!c){if(e&&e.id&&e.email&&e.role&&"authenticated"!==e.role&&"unauthenticated"!==e.role){i({...e,full_name:(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"User",role:e.role}),m(!1),d(!1);return}if(e&&e.id&&e.role&&("contractor"===e.role||"landlord"===e.role)){m(!1),d(!1);return}m(!0),g(t=>new Set(t).add(e.id));try{let t="contractor",a="https://jfgm6v6pkw.us-east-1.awsapprunner.com/api",[s,n]=await Promise.all([fetch("".concat(a,"/partner-login-check"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})}).then(e=>e.json()).catch(()=>({exists:!1})),fetch("".concat(a,"/client-login-check"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})}).then(e=>e.json()).catch(()=>({exists:!1}))]);s.exists?t="landlord":n.exists?t="contractor":e.email&&e.email.includes("landlord")&&(t="landlord");let r={...e,full_name:(null===(o=e.email)||void 0===o?void 0:o.split("@")[0])||"User",role:t,is_active:!0,email_verified:!!e.email_confirmed_at};i(r),m(!1),d(!1);return}catch(o){console.error("Error fetching user profile:",o);let t=e.email&&e.email.includes("landlord")?"landlord":"contractor";i({...e,full_name:(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"User",role:t}),m(!1),d(!1)}finally{m(!1)}}},b=async()=>{await n.supabase.auth.signOut(),i(null),g(new Set)};return(0,a.jsx)(r.Provider,{value:{user:o,loading:l,signOut:b},children:t})}},5526:function(e,t,o){"use strict";o.r(t),o.d(t,{supabase:function(){return a}});let a=(0,o(8439).eI)("https://gtdjjsxtlgzntmuimyai.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0ZGpqc3h0bGd6bnRtdWlteWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzA3MjEsImV4cCI6MjA3MzU0NjcyMX0.OIU7JU8oxYb6LrRuTbRJGhWtcy6gH7_5JlML23D2sWE")}},function(e){e.O(0,[439,648,145,971,117,744],function(){return e(e.s=9509)}),_N_E=e.O()}]);